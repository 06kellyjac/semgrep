#! /usr/bin/env bash
#
# Create a version.ml file. Requires being in a git repo.
#
set -eu

if [[ -n "$SEMGREP_VERSION" ]]; then
  version=$SEMGREP_VERSION
else
  version=$(git describe --always --dirty --tags --long)
fi

if [[ -z "$version" ]]; then
  echo "Failed to obtain version string." >&2
  exit 1
fi

cat <<EOF
(* generated at build time by $0 *)

(*
  semgrep-core version.
*)
let version = "$version"
EOF
